================================================================================
INSTRUCCIONES: SPs Faltantes - M√≥dulo Estacionamiento P√∫blico
================================================================================
Fecha: 2025-11-09
M√≥dulo: estacionamiento_publico
Total SPs: 4
================================================================================

üìã RESUMEN
----------
Se implementaron 4 Stored Procedures que estaban faltantes y bloqueaban
componentes cr√≠ticos del m√≥dulo estacionamiento_publico:

1. spget_lic_grales (CR√çTICO)
2. spget_lic_detalles (MEDIO)
3. sp_sfrm_baja_pub (ALTO)
4. spubreports (ALTO - Wrapper)

Componentes desbloqueados:
- ConsultaPublicos.vue (CR√çTICO)
- BajasPublicos.vue (ALTO)
- PagosPublicos.vue (ALTO)
- ReportesPublicos.vue (MEDIO)

================================================================================

üìÅ ARCHIVOS GENERADOS
---------------------

1. Archivos SQL individuales:
   üìÑ spget_lic_grales.sql
   üìÑ spget_lic_detalles.sql
   üìÑ sp_sfrm_baja_pub.sql
   üìÑ spubreports.sql

2. Script consolidado de despliegue:
   üìÑ deploy/DEPLOY_SPS_FALTANTES.sql

3. Reportes y documentaci√≥n:
   üìÑ sps-faltantes-implementados.json (Reporte t√©cnico JSON)
   üìÑ REPORTE-SPS-FALTANTES.md (Documentaci√≥n completa)
   üìÑ INSTRUCCIONES-SPS-FALTANTES.txt (Este archivo)

================================================================================

üöÄ C√ìMO DESPLEGAR
----------------

OPCI√ìN 1: Despliegue consolidado (RECOMENDADO)
-----------------------------------------------
Ejecuta el script consolidado que incluye los 4 SPs:

Windows:
  cd C:\Sistemas\RefactorX\Guadalajara\RecodePHP\GDL\RefactorX\Base\estacionamiento_publico\database
  SET PGPASSWORD=FF)-BQk2
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f deploy\DEPLOY_SPS_FALTANTES.sql

Linux/Mac:
  cd /path/to/RefactorX/Base/estacionamiento_publico/database
  export PGPASSWORD='FF)-BQk2'
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f deploy/DEPLOY_SPS_FALTANTES.sql


OPCI√ìN 2: Despliegue individual
--------------------------------
Si prefieres desplegar los SPs uno por uno:

Windows:
  cd C:\Sistemas\RefactorX\Guadalajara\RecodePHP\GDL\RefactorX\Base\estacionamiento_publico\database\database
  SET PGPASSWORD=FF)-BQk2

  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spget_lic_grales.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spget_lic_detalles.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f sp_sfrm_baja_pub.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spubreports.sql

Linux/Mac:
  cd /path/to/database/database
  export PGPASSWORD='FF)-BQk2'

  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spget_lic_grales.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spget_lic_detalles.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f sp_sfrm_baja_pub.sql
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias -f spubreports.sql

================================================================================

‚úÖ VERIFICACI√ìN
--------------

Despu√©s del despliegue, verifica que los SPs est√©n creados correctamente:

Conectarse a la BD:
  SET PGPASSWORD=FF)-BQk2
  psql -h 192.168.6.146 -p 5432 -U refact -d padron_licencias

Verificar SPs:
  \df spget_lic_grales
  \df spget_lic_detalles
  \df sp_sfrm_baja_pub
  \df spubreports

Salir:
  \q

Resultado esperado:
- Cada comando \df debe mostrar 1 funci√≥n con sus par√°metros
- Si no aparece nada, el SP no se despleg√≥ correctamente

================================================================================

üß™ PRUEBAS
----------

1. PRUEBA spget_lic_grales (CR√çTICO)
------------------------------------
En la BD:
  SELECT * FROM spget_lic_grales(12345, 0, 4);
  -- Reemplaza 12345 con un n√∫mero de licencia real

En la aplicaci√≥n:
  - Abrir ConsultaPublicos.vue
  - Buscar un estacionamiento
  - Hacer clic en el bot√≥n "Ver detalles" (√≠cono ojo)
  - Seleccionar la pesta√±a "Licencia"
  - Ingresar un valor en "Reca" (ej: 4)
  - Hacer clic en "Cargar"
  - Debe mostrar informaci√≥n de la licencia


2. PRUEBA spget_lic_detalles (MEDIO)
-------------------------------------
En la BD:
  SELECT * FROM spget_lic_detalles(1, 'L', 'N');
  -- Reemplaza 1 con un ID de licencia real

En la aplicaci√≥n:
  - Abrir ReportesPublicos.vue
  - Ingresar un ID de licencia
  - Hacer clic en "Ejecutar"
  - Debe mostrar tabla con conceptos y montos


3. PRUEBA sp_sfrm_baja_pub (ALTO)
----------------------------------
‚ö†Ô∏è CUIDADO: Esta prueba MODIFICA datos

En la BD (usar transacci√≥n):
  BEGIN;
  SELECT * FROM sp_sfrm_baja_pub('12345', 'Prueba de baja');
  ROLLBACK; -- Para deshacer los cambios

En la aplicaci√≥n:
  - Abrir BajasPublicos.vue
  - Ingresar n√∫mero de licencia
  - Ingresar motivo de baja
  - Hacer clic en "Dar de baja"
  - Debe mostrar mensaje de √©xito con folio de baja


4. PRUEBA spubreports (ALTO)
-----------------------------
En la BD:
  SELECT * FROM spubreports(1);  -- Ordenar por categor√≠a
  SELECT * FROM spubreports(2);  -- Ordenar por sector
  SELECT * FROM spubreports();   -- Sin par√°metro (usa default=1)

En la aplicaci√≥n:
  - Abrir PagosPublicos.vue o ReportesPublicos.vue
  - Hacer clic en "Consultar" o "Ejecutar SPUBREPORTS"
  - Debe mostrar listado de estacionamientos

================================================================================

‚ö†Ô∏è NOTAS IMPORTANTES
--------------------

1. MONTOS EN spget_lic_detalles
   Los montos retornados son EJEMPLOS. Debes ajustarlos seg√∫n las tarifas
   reales del municipio de Guadalajara.

   Para actualizar:
   - Editar el archivo spget_lic_detalles.sql
   - Buscar las l√≠neas con los montos (ej: "v_cupo * 100.00", "500.00", etc.)
   - Reemplazar con los montos correctos
   - Re-desplegar el SP

2. TABLA DE AUDITOR√çA
   El SP sp_sfrm_baja_pub intenta registrar en auditoria_estacionamientos.
   Si la tabla no existe, contin√∫a sin error pero no guarda auditor√≠a.

   Para crear la tabla (OPCIONAL):

   CREATE TABLE IF NOT EXISTS auditoria_estacionamientos (
       id SERIAL PRIMARY KEY,
       tabla VARCHAR(50),
       operacion VARCHAR(20),
       id_registro INTEGER,
       usuario VARCHAR(50),
       fecha TIMESTAMP,
       descripcion TEXT
   );

3. CAMPOS VAC√çOS EN spget_lic_grales
   Algunos campos retornan vac√≠os porque no se encontr√≥ su fuente en el
   sistema original:
   - actividad
   - reglamentada
   - letext, numint, letint
   - colonia
   - espubic
   - asiento, curp
   - sup_autorizada, aforo, rhorario
   - fecha_consejo
   - mensajes (mensaje1-8)

   Estos pueden completarse consultando tablas adicionales si es necesario.

4. PERMISOS
   Aseg√∫rate de que el usuario 'refact' tenga permisos para:
   - CREATE FUNCTION
   - SELECT en tablas: pubmain, pubcategoria
   - UPDATE en tabla: pubmain (para sp_sfrm_baja_pub)
   - INSERT en tabla: auditoria_estacionamientos (si existe)

================================================================================

üìä DATOS DE CONEXI√ìN
--------------------

Host: 192.168.6.146
Port: 5432
Database: padron_licencias
Username: refact
Password: FF)-BQk2
Esquema: public

Tablas principales:
- pubmain (estacionamientos p√∫blicos)
- pubcategoria (categor√≠as)
- auditoria_estacionamientos (auditor√≠a - verificar existencia)

================================================================================

üìû SOPORTE
----------

Si encuentras alg√∫n error o tienes dudas:

1. Revisa el reporte completo: REPORTE-SPS-FALTANTES.md
2. Revisa el archivo JSON t√©cnico: sps-faltantes-implementados.json
3. Verifica los logs de PostgreSQL
4. Ejecuta las pruebas de verificaci√≥n arriba indicadas

Errores comunes:

- "psql: command not found"
  ‚Üí Verifica que PostgreSQL est√© instalado y en el PATH
  ‚Üí Usa la ruta completa: "C:\Program Files\PostgreSQL\16\bin\psql.exe"

- "function already exists"
  ‚Üí Normal si re-despliegas. El script usa CREATE OR REPLACE.

- "permission denied"
  ‚Üí Verifica que el usuario 'refact' tenga permisos suficientes.

- "table does not exist"
  ‚Üí Para sp_sfrm_baja_pub: crear tabla auditoria_estacionamientos (ver nota 2)
  ‚Üí Para otros SPs: verificar que existan pubmain y pubcategoria

================================================================================

‚úÖ CHECKLIST POST-DESPLIEGUE
----------------------------

‚ñ° Desplegados los 4 SPs en la BD
‚ñ° Verificados con \df (cada uno debe aparecer)
‚ñ° Probado spget_lic_grales en BD
‚ñ° Probado spget_lic_detalles en BD
‚ñ° Probado sp_sfrm_baja_pub en BD (con ROLLBACK)
‚ñ° Probado spubreports en BD
‚ñ° Probado ConsultaPublicos.vue (pesta√±a Licencia)
‚ñ° Probado BajasPublicos.vue
‚ñ° Probado PagosPublicos.vue
‚ñ° Probado ReportesPublicos.vue
‚ñ° Ajustados los montos en spget_lic_detalles (si aplica)
‚ñ° Creada tabla auditoria_estacionamientos (si se requiere auditor√≠a)
‚ñ° Documentaci√≥n revisada por el equipo
‚ñ° Validado con usuarios finales

================================================================================

üìù HISTORIAL DE CAMBIOS
-----------------------

2025-11-09
  - Implementaci√≥n inicial de los 4 SPs faltantes
  - Creaci√≥n de documentaci√≥n completa
  - Despliegue exitoso en BD de desarrollo
  - Verificaci√≥n de funcionalidad

================================================================================

Generado: 2025-11-09
Por: Claude Code (Asistente de Desarrollo)
M√≥dulo: estacionamiento_publico
Versi√≥n: 1.0

================================================================================

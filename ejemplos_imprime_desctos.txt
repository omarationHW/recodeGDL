=== EJEMPLOS PARA PROBAR ImprimeDesctos.vue ===

El componente y stored procedure han sido actualizados para mostrar informaciÃ³n completa de descuentos.

IMPORTANTE:
- Ahora usa la tabla publico.aut_desctosotorgados (no crea nuevas tablas)
- Muestra informaciÃ³n detallada de los descuentos encontrados
- BÃºsqueda por ID de multa (clave de cuenta) y ejercicio (aÃ±o)
- InformaciÃ³n organizada en secciones visuales
- Validaciones de entrada implementadas

--- EJEMPLO 1: BÃºsqueda exitosa con descuentos ---

Clave de Cuenta: 407185
AÃ±o (Ejercicio): 2024

Resultado esperado:
âœ“ Status: success
âœ“ Mensaje: "Reporte de descuentos generado exitosamente. Se encontraron 3 descuento(s)."

INFORMACIÃ“N MOSTRADA:

ğŸ“„ InformaciÃ³n del Reporte:
- Folio del Reporte: RDESC-2024-20251218020557-2516
- Clave de Cuenta: 407185
- Ejercicio: 2024
- Fecha de GeneraciÃ³n: 18 de diciembre de 2025
- Total de Descuentos: 3
- Porcentaje Promedio: 95.00%

ğŸ’° Monto Total de Descuentos:
$0.00
(Mostrado en grande y destacado)

ğŸ“‹ Detalles de Descuentos:
Folio: 28, Multa: 407185, AÃ±o: 2024, % Aut: 95, Monto: $0.00, Vigencia: C
Folio: 29, Multa: 407185, AÃ±o: 2024, % Aut: 95, Monto: $0.00, Vigencia: C
Folio: 30, Multa: 407185, AÃ±o: 2024, % Aut: 95, Monto: $0.00, Vigencia: B


--- EJEMPLO 2: Otra cuenta con descuentos ---

Clave de Cuenta: 413995
AÃ±o (Ejercicio): 2025

Resultado esperado:
âœ“ Status: success
âœ“ Mensaje: "Reporte de descuentos generado exitosamente. Se encontraron 2 descuento(s)."

INFORMACIÃ“N MOSTRADA:
- Total de Descuentos: 2
- Porcentaje Promedio: 30.00%
- Monto Total: $0.00
- Detalles con los folios y datos de cada descuento


--- EJEMPLO 3: Cuenta con descuento monetario ---

Clave de Cuenta: 317396
AÃ±o (Ejercicio): 2013

Resultado esperado:
âœ“ Status: success
âœ“ Se encontraron descuentos con monto real
âœ“ Monto Total: $1,000.00
âœ“ Toda la informaciÃ³n organizada visualmente


--- EJEMPLO 4: Cuenta inexistente ---

Clave de Cuenta: CUENTA_NO_EXISTE_999
AÃ±o (Ejercicio): 2025

Resultado esperado:
âœ— Status: error
âœ— Mensaje: "No se encontraron descuentos para la cuenta CUENTA_NO_EXISTE_999 en el ejercicio 2025"
âœ— Se muestra en rojo (alert-danger)


--- EJEMPLO 5: Campo cuenta vacÃ­o (validaciÃ³n) ---

Clave de Cuenta: (dejar vacÃ­o)
AÃ±o (Ejercicio): 2025

Resultado esperado:
âœ— BotÃ³n deshabilitado (no se puede hacer clic)
âœ— ValidaciÃ³n en frontend impide el envÃ­o

Si se envÃ­a vacÃ­o desde el backend:
âœ— Status: error
âœ— Mensaje: "La clave de cuenta es obligatoria"


--- EJEMPLO 6: Campo ejercicio vacÃ­o (validaciÃ³n) ---

Clave de Cuenta: 407185
AÃ±o (Ejercicio): (dejar vacÃ­o o poner 0)

Resultado esperado:
âœ— BotÃ³n deshabilitado (no se puede hacer clic)
âœ— ValidaciÃ³n en frontend impide el envÃ­o

Si se envÃ­a 0 desde el backend:
âœ— Status: error
âœ— Mensaje: "El ejercicio (aÃ±o) es obligatorio"


--- ESTRUCTURA VISUAL DEL RESULTADO ---

Cuando es exitoso:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ“ Reporte de descuentos generado           â”‚
â”‚   exitosamente. Se encontraron 3           â”‚
â”‚   descuento(s).                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                             â”‚
â”‚ ğŸ“„ InformaciÃ³n del Reporte                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ Folio         â”‚ Clave Cuenta  â”‚          â”‚
â”‚ â”‚ Ejercicio     â”‚ Fecha         â”‚          â”‚
â”‚ â”‚ Total Desctos â”‚ % Promedio    â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                             â”‚
â”‚ ğŸ’° Monto Total de Descuentos               â”‚
â”‚        $1,000.00                           â”‚
â”‚   (Destacado en grande)                    â”‚
â”‚                                             â”‚
â”‚ ğŸ“‹ Detalles de Descuentos                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚ â”‚ Folio: 28, Multa: 407185,    â”‚          â”‚
â”‚ â”‚ AÃ±o: 2024, % Aut: 95,        â”‚          â”‚
â”‚ â”‚ Monto: $0.00, Vigencia: C    â”‚          â”‚
â”‚ â”‚                               â”‚          â”‚
â”‚ â”‚ Folio: 29, Multa: 407185,    â”‚          â”‚
â”‚ â”‚ AÃ±o: 2024, % Aut: 95, ...    â”‚          â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


--- MEJORAS VISUALES IMPLEMENTADAS ---

1. **OrganizaciÃ³n por secciones**
   - InformaciÃ³n del Reporte (6 campos)
   - Monto Total de Descuentos destacado
   - Detalles de Descuentos (hasta 10 registros)

2. **Grid responsive**
   - Los campos se organizan en columnas
   - Se adapta al tamaÃ±o de la pantalla
   - MÃ­nimo 250px por columna

3. **Monto destacado**
   - TamaÃ±o grande (2rem)
   - Color verde oscuro
   - Fondo semitransparente
   - Centrado y con padding

4. **Detalles de descuentos**
   - Formato monoespaciado (Courier New)
   - Fondo con color semitransparente
   - Line-height 1.6 para mejor lectura
   - MÃ¡ximo 10 descuentos mostrados

5. **Etiquetas y valores claros**
   - Etiquetas en verde claro (80% opacidad)
   - Valores en negrita y color completo
   - SeparaciÃ³n vertical clara

6. **Iconos descriptivos**
   - ğŸ“„ file-alt para informaciÃ³n del reporte
   - ğŸ’° dollar-sign para monto total
   - ğŸ“‹ list para detalles de descuentos
   - âœ“ check-circle para Ã©xito
   - âœ— times-circle para error

7. **Loading state**
   - Spinner mientras procesa
   - Texto "Procesando..."
   - BotÃ³n deshabilitado durante carga


--- VALIDACIONES IMPLEMENTADAS ---

Frontend:
1. BotÃ³n deshabilitado si falta clave de cuenta o ejercicio
2. Ambos campos son obligatorios
3. Ejercicio debe ser un nÃºmero entero
4. Texto de ayuda en cada campo
5. Enter key para enviar formulario

Backend (Stored Procedure):
1. Valida que la clave no estÃ© vacÃ­a
2. Valida que el ejercicio no sea 0 o NULL
3. Busca en aut_desctosotorgados por id_multa y ejercicio
4. Retorna error descriptivo si no encuentra datos


--- FORMATO DE FECHAS ---

Las fechas se muestran en formato largo en espaÃ±ol:
- "18 de diciembre de 2025"
- AutomÃ¡tico segÃºn el locale del navegador


--- FORMATO DE MONEDA ---

Los montos se formatean como pesos mexicanos:
- $1,000.00
- Con separador de miles
- Dos decimales
- SÃ­mbolo de pesos


--- CAMPOS RETORNADOS POR EL SP ---

El stored procedure retorna:
- status: 'success' o 'error'
- mensaje: DescripciÃ³n del resultado
- folio_reporte: Folio Ãºnico (RDESC-YYYY-TIMESTAMP-RANDOM)
- fecha_generacion: Fecha actual
- total_descuentos: Cantidad de descuentos encontrados
- monto_total: Suma de montos autorizados
- porcentaje_promedio: Promedio de % autorizados
- detalles_descuentos: Texto con detalle de cada descuento (max 10)


--- LÃ“GICA DE NEGOCIO ---

1. **BÃºsqueda flexible**:
   - Busca por id_multa (clave de cuenta) en aut_desctosotorgados
   - TambiÃ©n busca por folio_descto si coincide exacto
   - Filtra por ejercicio (aÃ±o) en campo axo
   - Usa ILIKE para bÃºsqueda parcial

2. **GeneraciÃ³n de folio**:
   - Formato: RDESC-YYYY-YYYYMMDDHH24MISS-RANDOM
   - No usa secuencias (evita el error original)
   - Ejemplo: RDESC-2024-20251218020557-2516
   - Ãšnico por timestamp + nÃºmero aleatorio

3. **CÃ¡lculos**:
   - COUNT(*) para total de descuentos
   - SUM(monto_aut) para monto total
   - AVG(por_aut) para porcentaje promedio
   - STRING_AGG para concatenar detalles

4. **Estados de vigencia**:
   - 'V' = Vigente
   - 'B' = Baja
   - 'C' = Cancelado
   - Se muestra en los detalles

5. **LÃ­mites**:
   - MÃ¡ximo 10 descuentos en detalles (para no saturar UI)
   - Todos se cuentan en total_descuentos
   - Todos se suman en monto_total


--- TABLA USADA ---

Base de datos: multas_reglamentos
Esquema: publico
Tabla: aut_desctosotorgados
Registros: 35 descuentos otorgados

Campos principales:
- folio_descto: ID del descuento
- id_multa: Clave de cuenta / ID de multa
- axo: AÃ±o del ejercicio
- por_aut: Porcentaje autorizado (0-100)
- monto_aut: Monto del descuento autorizado
- vigencia: Estado (V/B/C)
- fecha_inicio: Fecha de inicio de vigencia
- fecha_fin: Fecha de fin de vigencia


--- PRUEBAS REALIZADAS ---

âœ“ BÃºsqueda exitosa por ID de multa (407185, aÃ±o 2024)
âœ“ BÃºsqueda exitosa con mÃºltiples descuentos (3 registros)
âœ“ CÃ¡lculo correcto de porcentaje promedio (95%)
âœ“ ValidaciÃ³n de cuenta vacÃ­a
âœ“ ValidaciÃ³n de ejercicio = 0
âœ“ ValidaciÃ³n de cuenta inexistente
âœ“ Formato correcto de moneda ($0.00)
âœ“ Formato correcto de fecha (18 de diciembre de 2025)
âœ“ VisualizaciÃ³n responsive
âœ“ Estados de Ã©xito y error
âœ“ Loading state durante proceso
âœ“ Detalles de descuentos con formato correcto
âœ“ Formato JSON correcto para frontend


--- CAMBIOS EN EL CÃ“DIGO ---

**Stored Procedure (update_sp_imprime_desctos.sql)**:
- Eliminada la dependencia de secuencia reportes_descuentos_id_reporte_seq
- Eliminada la inserciÃ³n en tabla reportes_descuentos
- Ahora busca en publico.aut_desctosotorgados
- Folio generado con timestamp + random (sin secuencia)
- Agrega porcentaje_promedio a la salida
- Agrega detalles_descuentos con STRING_AGG
- Validaciones mejoradas
- BÃºsqueda flexible (id_multa o folio_descto)

**Vue Component (ImprimeDesctos.vue)**:
- Agregadas secciones detalladas de informaciÃ³n
- Grid responsive con auto-fit
- FunciÃ³n formatDate() agregada
- SecciÃ³n de "Monto Total de Descuentos" destacada
- SecciÃ³n de "Detalles de Descuentos" con formato monoespaciado
- Campo de "Porcentaje Promedio" agregado
- CSS completo para visualizaciÃ³n profesional


--- INTEGRACIÃ“N CON EL SISTEMA ---

El componente usa:
- useApi() composable para llamadas API
- BASE_DB: 'multas_reglamentos'
- OP_REPORTE: 'RECAUDADORA_IMPRIME_DESCTOS'
- SCHEMA: 'publico'
- ParÃ¡metros:
  - p_clave_cuenta (string): ID de multa o folio
  - p_ejercicio (integer): AÃ±o del ejercicio

Flujo:
1. Usuario ingresa clave de cuenta y aÃ±o
2. Frontend valida que ambos campos no estÃ©n vacÃ­os
3. Se envÃ­a a travÃ©s de useApi con execute()
4. Backend ejecuta SP publico.recaudadora_imprime_desctos
5. SP busca en aut_desctosotorgados por id_multa y axo
6. SP calcula totales, promedios y genera detalles
7. Retorna JSON con 8 campos
8. Frontend parsea y muestra en secciones organizadas


--- NOTAS TÃ‰CNICAS ---

1. Los montos en aut_desctosotorgados pueden ser NULL o 0
   - Se usa COALESCE para manejar NULLs
   - Suma correcta incluso con valores NULL

2. El campo axo puede ser 0 en algunos registros
   - Esto indica que no tiene aÃ±o especÃ­fico
   - La bÃºsqueda con ejercicio=0 se rechaza ahora (validaciÃ³n)

3. Algunos descuentos tienen monto_aut = 0
   - Esto indica que se aplicÃ³ solo porcentaje
   - El porcentaje se calcula sobre el adeudo original

4. Vigencia indica el estado actual del descuento
   - 'V' = Vigente (puede aplicarse)
   - 'B' = Baja (ya no es vÃ¡lido)
   - 'C' = Cancelado (fue anulado)

5. STRING_AGG concatena hasta 10 registros
   - Usa '\n' como separador
   - Formato legible en el frontend
   - Si hay mÃ¡s de 10, solo muestra los primeros 10


--- DIFERENCIAS CON LA VERSIÃ“N ANTERIOR ---

Antes:
- Usaba secuencia que no existÃ­a (causaba el error)
- Insertaba en tabla reportes_descuentos que no existe
- Retornaba datos simulados estÃ¡ticos
- No buscaba datos reales

Ahora:
- No usa secuencias (folio con timestamp)
- No inserta en ninguna tabla (solo consulta)
- Retorna datos reales de aut_desctosotorgados
- BÃºsqueda funcional con filtros reales
- MÃ¡s campos de informaciÃ³n (8 vs 6)
- Detalles de descuentos incluidos

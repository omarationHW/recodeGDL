=== EJEMPLOS PARA PROBAR ListaDiferencias.vue ===

El stored procedure ha sido actualizado para usar la tabla existente:
- public.diferencias_glosa (2,738 registros)

IMPORTANTE:
- 2,078 diferencias pendientes disponibles
- 511 diferencias vigentes
- 149 diferencias canceladas
- Paginación ya incluida en el componente (10 registros por página)
- Búsqueda por defecto en todas las diferencias

--- PROBLEMA ORIGINAL ---

Error: relation "publico.diferencias" does not exist

--- SOLUCIÓN ---

Ahora usa la tabla public.diferencias_glosa existente

--- PARÁMETRO DEL COMPONENTE ---

El componente Vue envía un parámetro de texto llamado 'p_filtro':
- Tipo: string (VARCHAR)
- Búsqueda: case-insensitive con ILIKE '%filtro%'
- Campos buscados: id, foliot, folio_glosa, cvecuenta, tipo_dif, diferen, usu_alta, vigencia
- Palabras clave especiales: VIGENTE, PENDIENTE, CANCELADO, PREDIAL, NORMAL, IMPUESTO, RECARGOS, MULTAS
- Por defecto: '' (vacío, trae todos los primeros 100)

--- EJEMPLO 1: Sin filtros (por defecto) ---

Búsqueda: Campo vacío o sin texto

Resultado esperado:
✓ 100 diferencias (límite máximo)
✓ Ordenadas por fecha descendente (más recientes primero)
✓ Incluye todos los estados (V, C, P)

Ejemplo de diferencia:
   ID: 2741
   Tipo Registro: PREDIAL
   Campo Afectado: IMPUESTO BASE
   Valor Sistema: Suma: $21,377.94
   Valor Registrado: Total: $0
   Diferencia Monto: $0.00
   Folio: T-405008
   Fecha: 2024-11-27
   Estado: PENDIENTE
   Responsable: lguevara


--- EJEMPLO 2: Búsqueda por tipo de registro ---

Búsqueda: "PREDIAL"

Resultado:
✓ 100 diferencias tipo PREDIAL (límite alcanzado)
✓ 2,591 diferencias prediales totales disponibles

Ejemplo:
   Tipo: PREDIAL
   Campo: IMPUESTO BASE
   Diferencia: $0.00
   Estado: PENDIENTE
   Folio: T-405008


--- EJEMPLO 3: Búsqueda por campo afectado ---

Búsqueda: "RECARGOS"

Resultado:
✓ 100 diferencias en RECARGOS (límite alcanzado)
✓ 893 diferencias de recargos totales disponibles

Ejemplo:
   Campo Afectado: RECARGOS
   Valor Sistema: Suma: $928.24
   Valor Registrado: Total: $928.24
   Diferencia: $0.00


--- EJEMPLO 4: Búsqueda por estado ---

Búsqueda: "PENDIENTE"

Resultado:
✓ 100 diferencias pendientes (límite alcanzado)
✓ 2,078 diferencias pendientes totales

Estados disponibles:
- PENDIENTE (P): 2,078
- VIGENTE (V): 511
- CANCELADO (C): 149


--- EJEMPLO 5: Búsqueda por usuario responsable ---

Búsqueda: "lguevara"

Resultado:
✓ 6 diferencias del usuario lguevara
✓ Búsqueda por campo responsable

Usuarios más activos:
- tagomez: 700 diferencias
- lmlomeli: 675 diferencias
- jmmarron: 169 diferencias


--- CAMPOS MOSTRADOS ---

| Campo              | Descripción                          | Ejemplo                  |
|--------------------|--------------------------------------|--------------------------|
| id_diferencia      | ID único de la diferencia            | 2741                     |
| tipo_registro      | Tipo de registro                     | PREDIAL / NORMAL         |
| campo_afectado     | Campo con diferencia                 | IMPUESTO BASE / RECARGOS |
| valor_sistema      | Valor calculado por sistema          | Suma: $928.24            |
| valor_registrado   | Valor registrado manualmente         | Total: $928.24           |
| diferencia_monto   | Monto de la diferencia               | 0.00                     |
| folio              | Folio del registro                   | T-405008 / G-41444       |
| fecha_deteccion    | Fecha de detección                   | 2024-11-27               |
| estado             | Estado de la diferencia              | PENDIENTE/VIGENTE/CANCEL |
| responsable        | Usuario responsable                  | lguevara                 |
| observaciones      | Observaciones adicionales            | (puede estar vacío)      |


--- TIPOS DE REGISTRO ---

| Código | Nombre   | Total  | Descripción                          |
|--------|----------|--------|--------------------------------------|
| P      | PREDIAL  | 2,591  | Diferencias en prediales             |
| N      | NORMAL   | 147    | Diferencias en otros registros       |


--- CAMPOS AFECTADOS ---

| Código | Nombre         | Total  | Descripción                          |
|--------|----------------|--------|--------------------------------------|
| I      | IMPUESTO BASE  | 1,812  | Diferencias en impuesto base         |
| R      | RECARGOS       | 893    | Diferencias en recargos              |
| M      | MULTAS         | 33     | Diferencias en multas                |


--- CÁLCULO DE DIFERENCIA ---

**Valor Sistema** (suma de componentes):
- importe_base
- recargos
- multas
- multasext
- imp_ot
- gastos

**Valor Registrado**:
- total (campo total de la tabla)

**Diferencia Monto**:
- |total - suma_componentes| (valor absoluto)
- Si es 0: Los valores coinciden, no hay discrepancia
- Si es > 0: Hay una discrepancia entre la suma y el total


--- TABLA USADA ---

Base de datos: multas_reglamentos
Esquema: public
Tabla: diferencias_glosa (2,738 registros)

Campos principales:
- id: ID único
- foliot: Folio de transmisión
- folio_glosa: Folio de glosa
- cvecuenta: Cuenta catastral
- fecha_alta: Fecha de registro
- usu_alta: Usuario responsable
- vigencia: Estado (V/C/P)
- tipo_dif: Tipo (P/N)
- diferen: Campo afectado (I/R/M)
- importe_base, recargos, multas, etc.: Componentes
- total: Total registrado
- observaciones: Observaciones


--- FILTROS APLICADOS ---

✓ Búsqueda de texto (p_filtro) aplica a:
  - ID de diferencia (id)
  - Folio transmisión (foliot)
  - Folio glosa (folio_glosa)
  - Cuenta catastral (cvecuenta)
  - Tipo de diferencia (tipo_dif)
  - Campo afectado (diferen)
  - Usuario responsable (usu_alta)
  - Estado (vigencia: V/C/P)
✓ Búsqueda por palabras clave:
  - VIGENTE, CANCELADO, PENDIENTE (estados)
  - PREDIAL, NORMAL (tipos)
  - IMPUESTO, RECARGOS, MULTAS (campos)
✓ Límite de 100 registros
✓ Ordenado por fecha descendente (fecha_alta DESC)
✓ Búsqueda case-insensitive (ILIKE)


--- PAGINACIÓN ---

✓ Ya incluida en el componente ListaDiferencias.vue
✓ 10 registros por página
✓ Navegación completa (primera, anterior, siguiente, última)
✓ Contador de registros
✓ Botones con íconos FontAwesome


--- FUNCIONES DEL COMPONENTE ---

✓ formatDate(fecha): Formatea fechas al formato español
✓ formatMoney(valor): Formatea montos con símbolo de peso
✓ buscar(): Se ejecuta con filtro de texto
✓ Tabla responsive con scroll horizontal


--- PRUEBAS REALIZADAS ---

✅ Sin filtro (texto vacío): 100 diferencias encontradas
✅ Filtro 'PREDIAL': 100 diferencias tipo predial
✅ Filtro 'RECARGOS': 100 diferencias de recargos
✅ Filtro 'PENDIENTE': 100 diferencias pendientes
✅ Filtro 'lguevara' (usuario): 6 diferencias
✅ Formato JSON correcto con 11 campos
✅ Cálculos de diferencia_monto correctos
✅ Mapeo de tipos y campos correctos
✅ Búsqueda case-insensitive funcional
✅ Filtros por palabras clave funcionales


--- ESTADÍSTICAS ---

Total de diferencias en BD: 2,738

Por estado:
- Pendientes (P): 2,078
- Vigentes (V): 511
- Cancelados (C): 149

Por tipo:
- Predial (P): 2,591
- Normal (N): 147

Por campo afectado:
- Impuesto Base (I): 1,812
- Recargos (R): 893
- Multas (M): 33

Rango de fechas: 2013-05-13 a 2024-11-27
Registros retornados por búsqueda: Hasta 100 (límite)


--- NOTAS IMPORTANTES ---

⚠️ La mayoría de las diferencias tienen diferencia_monto = 0
   Esto significa que la suma de componentes coincide con el total
   Solo las diferencias con monto > 0 tienen discrepancias reales

⚠️ El folio puede tener dos formatos:
   - T-XXXXX: Folio de transmisión (foliot)
   - G-XXXXX: Folio de glosa (folio_glosa)

⚠️ El componente busca automáticamente al cargar si tiene filtro

⚠️ El límite de 100 registros evita sobrecargar el frontend

⚠️ Los usuarios más activos son tagomez y lmlomeli


--- ESTADOS ---

| Código | Nombre      | Descripción                          |
|--------|-------------|--------------------------------------|
| V      | VIGENTE     | Diferencia vigente                   |
| C      | CANCELADO   | Diferencia cancelada                 |
| P      | PENDIENTE   | Diferencia pendiente de resolver     |


--- RESUMEN ---

**Problema**: Tabla publico.diferencias no existe

**Solución**: Usa tabla public.diferencias_glosa existente

**Resultado**: Componente funcional con 2,738 diferencias disponibles

**Características**:
- Búsqueda por múltiples campos
- Cálculo automático de diferencias de monto
- Mapeo de tipos y campos a nombres descriptivos
- Paginación incluida
- Límite de 100 registros por consulta
- Filtros por palabras clave especiales


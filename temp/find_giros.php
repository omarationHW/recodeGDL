<?php $pdo_m = new PDO("pgsql:host=192.168.6.146;port=5432;dbname=mercados", "refact", "FF)-BQk2", [PDO::ATTR_ERRMODE => PDO::ERRMODE_EXCEPTION]); echo "Buscando tablas con 'giro' en mercados:\n"; $tables = $pdo_m->query("SELECT table_schema, table_name FROM information_schema.tables WHERE table_schema IN ('public', 'publico') AND LOWER(table_name) LIKE '%giro%' ORDER BY table_name")->fetchAll(PDO::FETCH_ASSOC); foreach ($tables as $t) { $count = $pdo_m->query("SELECT COUNT(*) FROM {$t['table_schema']}.{$t['table_name']}")->fetchColumn(); echo "  • {$t['table_schema']}.{$t['table_name']}: $count registros\n"; } echo "\nVerificando campos de ta_11_locales que contienen 'giro':\n"; $cols = $pdo_m->query("SELECT column_name, data_type FROM information_schema.columns WHERE table_schema = 'publico' AND table_name = 'ta_11_locales' AND LOWER(column_name) LIKE '%giro%'")->fetchAll(PDO::FETCH_ASSOC); foreach ($cols as $c) { echo "  • {$c['column_name']}: {$c['data_type']}\n"; } echo "\nValores distintos de giro en ta_11_locales:\n"; $giros = $pdo_m->query("SELECT DISTINCT giro, COUNT(*) as total FROM publico.ta_11_locales WHERE giro IS NOT NULL GROUP BY giro ORDER BY giro LIMIT 20")->fetchAll(PDO::FETCH_ASSOC); foreach ($giros as $g) { echo "  • Giro {$g['giro']}: {$g['total']} locales\n"; } ?>
